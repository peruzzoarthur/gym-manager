generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["metrics"]
}

generator docs {
  provider = "node node_modules/prisma-docs-generator"
}

generator dbml {
  provider = "prisma-dbml-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String     @id @default(uuid())
  firstName        String?
  lastName         String?
  email            String     @unique
  password         String
  dob              DateTime?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  role             Role       @default(USER)
  hashedRt         String?
  profileImage     String?
  trainings        Training[]
  activeTraining   Training?  @relation("ActiveTraining", references: [id], fields: [activeTrainingId])
  activeTrainingId String?
  trainingsCreated Training[] @relation("TrainingCreator")
}

enum Role {
  USER
  ADMIN
}

model Training {
  id              String          @id @default(uuid())
  name            String?
  trainingGroups  TrainingGroup[]
  users           User[]
  activatedAtUser User[]          @relation("ActiveTraining")
  tempo           Tempo
  daysInWeek      Int
  done            Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  // rounds          Int
  reps            Int
  sets            Int
  rest            Int
  objective       String?
  createdBy       User            @relation("TrainingCreator", fields: [createdByUserId], references: [id])
  createdByUserId String
}

model TrainingGroup {
  id         String     @id @default(uuid())
  key        String
  exercises  Exercise[]
  done       Boolean    @default(false)
  doneAt     DateTime?
  groups     Group[]
  training   Training   @relation(fields: [trainingId], references: [id])
  trainingId String
  phase      Phase
  number     Int

  @@unique([key, trainingId, phase, number])
}

enum Phase {
  CIS
  ONE
  TWO
}

model Exercise {
  id             String            @id @default(uuid())
  ref            ExerciseReference @relation(fields: [refId], references: [id])
  refId          String
  load           Float?
  reps           Int?
  sets           Int?
  trainingGroups TrainingGroup[]
  index          Int?
}

model ExerciseReference {
  id        String     @id @default(uuid())
  name      String     @unique()
  exercises Exercise[]
  groups    Group[]
}

enum Tempo {
  ONE2ONE
  ONE2TWO
  ONE2THREE
  ONE2FOUR
}

enum Group {
  CHEST
  BACK
  TRICEPS
  BICEPS
  LEGS
  CALVES
  COMPLEX
  SHOULDERS
}
